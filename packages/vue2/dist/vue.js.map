{"version":3,"file":"vue.js","sources":["../src/dep.js","../src/watcher.js","../src/compiler.js","../src/observe.js","../src/index.js"],"sourcesContent":["export default class Dep {\r\n  constructor() {\r\n    this.deps = [];\r\n  }\r\n\r\n  addDeps(watcher) {\r\n    this.deps.push(watcher);\r\n  }\r\n\r\n  notify() {\r\n    this.deps.forEach(watcher => watcher.update());\r\n  }\r\n}\r\n","import Dep from \"./dep.js\";\r\n\r\nexport default class Watcher {\r\n  constructor(vm, key, cb) {\r\n    this.$vm = vm;\r\n    this.$key = key;\r\n    this.$cb = cb;\r\n\r\n    Dep.target = this;\r\n    this.$vm[key]\r\n    Dep.target= null;\r\n  }\r\n\r\n  update() {\r\n    this.$cb.call(this.$vm, this.$vm[this.$key]);\r\n  }\r\n}\r\n","import Watcher from \"./watcher.js\";\r\n\r\nexport default class Compiler {\r\n  constructor(el, vm) {\r\n    this.$el = document.querySelector(el);\r\n    this.$vm = vm;\r\n\r\n    this.compile(this.$el)\r\n  }\r\n\r\n  \r\n  compile(el) {\r\n    const { childNodes } = el;\r\n    Array.from(childNodes).forEach(node => {\r\n      if(this.isEle(node)) {\r\n        this.compileEle(node)\r\n\r\n        if(node.childNodes && node.childNodes.length) {\r\n          this.compile(node)\r\n        }\r\n      }\r\n      if(this.isInterpolation(node)) {\r\n        this.compileText(node)\r\n      }\r\n\r\n    })\r\n  }\r\n\r\n  isEle(node) {\r\n    return node.nodeType === 1\r\n  }\r\n\r\n  compileEle(node) {\r\n    Array.from(node.attributes).forEach(attr => {\r\n      const name = attr.name;\r\n      if(this.isStartsWithV(name)) {\r\n        const dir = name.slice(2);\r\n        const exp = attr.value;\r\n\r\n        this.update(node, exp, dir)\r\n      }\r\n    })\r\n  }\r\n\r\n  update(node, exp, action) {\r\n    const fnName = `${action}Update`\r\n    const fn = this[fnName]\r\n    // init\r\n    fn && fn(node, this.$vm[exp])\r\n\r\n    // update\r\n    new Watcher(this.$vm, exp, function(val) {\r\n      fn && fn(node, val)\r\n    })\r\n  }\r\n\r\n  textUpdate(node, val) {\r\n    node.textContent = val;\r\n  }\r\n\r\n  htmlUpdate(node, val) {\r\n    node.innerHTML = val;\r\n  }\r\n\r\n  isStartsWithV(str) {\r\n    return str.startsWith('v-')\r\n  }\r\n\r\n  isInterpolation(node) {\r\n    return node.nodeType === 3 && /^\\{\\{(.*)\\}\\}$/.test(node.textContent);\r\n  }\r\n\r\n  compileText(node) {\r\n    this.update(node, RegExp.$1, 'text')\r\n  }\r\n}\r\n","import Dep from \"./dep.js\";\r\nimport Watcher from \"./watcher.js\";\r\n\r\nexport function observe(param) {\r\n  if (typeof param !== \"object\" || param === null) {\r\n    return param;\r\n  }\r\n\r\n  return new Observer(param);\r\n}\r\n\r\nclass Observer {\r\n  constructor(obj) {\r\n    this.value = obj;\r\n\r\n    if (Array.isArray(obj)) {\r\n      // todo\r\n    } else {\r\n      this.walk(obj);\r\n    }\r\n  }\r\n\r\n  walk(obj) {\r\n    Object.keys(obj).forEach(key => {\r\n      defineProperty(obj, key, obj[key]);\r\n    });\r\n  }\r\n}\r\n\r\nfunction defineProperty(obj, key, val) {\r\n  observe(val);\r\n  const dep = new Dep()\r\n\r\n  Object.defineProperty(obj, key, {\r\n    get: function() {\r\n      console.log(\"get: key-\" + key + \"value-\" + val);\r\n      if(Dep.target) {\r\n        dep.addDeps(Dep.target);\r\n      }\r\n      return val;\r\n    },\r\n    set: function(v) {\r\n      if (v !== val) {\r\n        console.log(\"set: key-\" + key + \"value-\" + v);\r\n        val = v;\r\n        dep.notify()\r\n      }\r\n    }\r\n  });\r\n}\r\n","import Compiler from \"./compiler.js\";\r\nimport { observe } from './observe.js';\r\n\r\nexport default class Vue {\r\n  constructor(options) {\r\n    this.$data = options.data;\r\n    this.$options = options;\r\n\r\n    observe(this.$data);\r\n\r\n    proxy(this);\r\n\r\n    new Compiler(options.el, this);\r\n  }\r\n}\r\n\r\nfunction proxy(vm) {\r\n  Object.keys(vm.$data).forEach(key => {\r\n    Object.defineProperty(vm, key, {\r\n      get: function() {\r\n        return vm.$data[key];\r\n      },\r\n      set: function(v) {\r\n        if (v !== vm.$data[key]) {\r\n          vm.$data[key] = v;\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n"],"names":[],"mappings":"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"}